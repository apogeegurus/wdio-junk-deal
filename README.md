# junkdeal-wdio-framework

This codebase is a minimum configuration of a WebDriverIO based testing framework, that includes a set of useful
features simplifying testing.

The list of features includes:

-   Predefined folders structure.
-   Configuration management to support CI and local test execution.
-   Linter and prettier.
-   Multiple reporters.
-   Logging.
-   Image comparison tools.
-   Classes for common FE testing use cases.
-   Publishing test results to PIE Quality (UNDER DEVELOPMENT).

## Contents

[Features](#features)

-   [Test Execution](#test-execution)
-   [Folders Structure](#folders-structure)
-   [Configuration Management](#configuration-management)
-   [Code Sanity](#code-sanity)
-   [Reporting](#reporting)
-   [Logging](#logging)
-   [Image Comparison](#image-comparison)
-   [Common Classes](#common-classes)
-   [Publishing Test Results to PIE Quality](#publishing-test-results-to-pie-quality)

[Design](#design)

-   [Main Principles](#main-principles)
-   [Unit Testing](#unit-testing)

## Features

### Test Execution

-   Navigate to the test framework folder
-   Run npm install
-   To run UI functional tests: npm run test:it
-   For performance tests: PERF_RUNS=5 PERF_CYCLES=5 npm run test:it:performance

### Folders Structure

```
├── allure-results // Reports generated by Allure.
├── config // Configurations files used for running wdio.
│   ├── appConfig.js // The default configuration.
│   ├── safari.json // A test configuration for running tests in Safari.
│   ├── wdio.conf.js // A configuration for running specs for a single locale.
│   └── wdio.multi.locales.conf.js // A configuration for running specs for multiple locales.
├── docs
├── log
├── specs // Specs isolated from the rest of the code for easier management.
│   ├── multi-locale // Specs that need to be executed as a group in a new webdriver session for each given locale.
│   │   ├── code-templates // Shared describe() and it() blocks that can be used in multiple specs.
│   │   ├── image-comparison // Specs for image comparison tests.
│   │   ├── single-page // Specs for testing single page scenarios.
│   │   └── user-flows // Specs for testing scenarios including navigation across multiple pages.
│   ├── single-locale // Specs that don't require creating a new webdriver session for each wdio capability.
│   │   ├── code-templates
│   │   ├── image-comparison
│   │   ├── single-page
│   │   └── user-flows
│   └── unit // Unit tests for the CORE code.
├── src // Code containing POM classes and other features used in specs.
│   ├── app // A POM representation of the SUT.
│   │   ├── common
│   │   │   ├── Component.js
│   │   │   ├── Page.js
│   │   │   └── instantiatePage.js
│   │   └── pages // POM classes for each page.
│   ├── data-providers // Classes to access input test data.
│   └── utils // Utilities. Each file contains a brief description explaining the file's purpose.
│       ├── helpers.js
│       ├── imageComparison.js
│       ├── initFunctions.js
│       └── logger.js
└── test-results // Screenshots and other files generated during test execution.
```

### Configuration Management

The implemented configuration management is based on the [convict](https://www.npmjs.com/package/convict)
library, and allows running tests with various configurations (locally, in CI, etc.). The default configuration is
located in ./config/appConfig.js. It describes common elements with default values and corresponding environment
variables. The default configuration can be merged with custom JSON configurations.

### Code Sanity

To get rid of common coding and style mistakes, CORE uses the [ESLint](https://github.com/eslint/eslint) linter
in a combination the [prettier](https://prettier.io).
The linter integrated with the project uses the [Google JavaScript Style Guide](https://google.github.io/styleguide/jsguide.html) preset.
The tools are integrating with the pre-commit Git hook, and are executed for all staged files.

### Reporting

CORE is integrated with the 2 following reporters:

-   specs - used for general test execution displaying a hierarchical representation of executed tests.
-   allure - used for generating fancy reports, but requires injecting Allure annotations.

### Logging

Logging is a crucial part of the framework and is used for tracking the test execution flow.
The general idea is to be able to get all details of test execution from logs.

There are 3 levels of log messages being used:

-   INFO - high-level messages describing major actions or group of actions.
-   VERBOSE - messages containing extra information about the action being executed.
-   DEBUG - messages with the maximum amount of information such as full HTTP requests and responses.

A good approach to decide what level of logging to use and where:

-   Add a VERBOSE message at the beginning of methods when tracking execution flow is necessary. The log message should
    also include given parameters, each surrounded with ‘’ (it helps detecting empty parameters).
-   Add a DEBUG message at each return point of the method. It’s extremely useful in methods with multiple exit points.
-   Add a timestamp in the methods that have multiple asynchronous exit points.

### Image Comparison

The [pixelmatch](https://github.com/mapbox/pixelmatch) library is used to provide functionality for verification of
pixel pushing and visual changes.

### Common Classes

To simplify creation of POM classes, CORE contains basic constructing blocks:

-   ./src/app/common/Component.js - a wrapper class for keeping WebdriverIO.Element.
    The class helps add extra functionality not supported by WebdriverIO.Element.
-   ./src/app/common/Page.js - the main class for creating POM pages.
    Includes additional methods for interacting with the page's elements and data.
-   ./src/app/common/instantiatePage.js - a method to generate a page instance based on the loaded URL.

### Publishing Test Results to PIE Quality

TBD.

## Design

### Main Principles

There are a few high-level principles that form the framework's architecture:

1. Encapsulating work with DOM of rendered pages into classes, to provide a convenient interface that can be used
   in Mocha tests.
2. Encapsulating test data into classes, to simplify the interface that can be used in Mocha tests.
3. Avoiding the “fail-first” strategy. Combining multiple assertions in a single test is a good option for saving time
   in CI by terminating test execution at the first failed assertion, but is not good for detailed analysis of the SUT
   state. Multiple Mocha assertions in test should be avoided, and are broken down into multiple tests containing
   1 assertion for better granulation.
4. Test scenarios clarity has a higher priority than test scenarios code duplication. When possible duplication
   is avoided, but not to the point when the code becomes hardly understandable and maintainable.

### Unit Testing

The code of the framework is no different from the application's code in regards to unit testing. All major pieces of
the framework should be covered with unit tests. Unit tests are located in ./specs/unit.

The "npm run test" command is reserved for unit testing. The command runs pure mocha using the config ./config/mocha.unit.conf.js.
Unit tests test execution generates 2 reports:

-   spec - redirected to stdout.
-   xunit - is written to ./test-results/junit.xml. This file is used to publish test results to PIE Quality.
